version: 2.1
jobs:
  build:
    # working_directory: ~/circle_test
    docker:
      - image: 'cimg/go:1.17.2'
    steps:
      - checkout
      - run:
          name: The First Step
          command: |
            echo 'Hello World!'
            echo 'This is the delivery pipeline'
      - run:
          name: git checking
          command: |
            go get -u github.com/go-swagger/go-swagger/cmd/swagger
            cd cmd; swagger generate spec -i ../tags.json -o swagger.json
            ls -al
  job-2:
    # working_directory: ~/circle_test
    docker:
      - image: 'cimg/go:1.17.2'
    working_directory: ~/go/src/github.com/ert4web/circle-test
    steps:
      - checkout
      - setup_remote_docker
      - run:
          name: Cnvert Swagger
          command: |
            docker run -it -p 8990:8080 --name swagger-converter swaggerapi/swagger-converter:v1.0.2
            sleep 5s
            docker ps -a
            curl -X POST http://localhost:8990/api/convert -d @swagger/static/swagger.json --header 'Content-Type: application/json' | jq > swagger/static/openapi.json
            docker rm -f swagger-converter
          
            
workflows:
  version: 2
  Example_Workflow:
    jobs:
      - build
      - job-2:
          requires:
            - build
